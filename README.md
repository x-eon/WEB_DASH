т.з. сервис сеточных торговых ботов


Фьючерсный рынок. Одновременна возможна торговля как лонг, так и шорт позиций, количество одновременно открытых сделок не ограничено.(главное в правила бинанса вписываться)


Signal – сигнал на открытие получен в соотвествии с алгоритмом (
Setka_l1(s1) – лонг сетка состоящая из лонг лимит ордеров с шагом Step. Количество ордеров, множитель количества между ордерами задаётся в настройках. 

-----------------------------Настройки-------------------------------
Clean_star = True – чистый запуск (стираем кэш)
Api_key = “” ключ
Api_secret = “” секрет
Whitelist = [‘BTC’, ‘ETH’,….] -  список торговых пар по которым разрешено открытие новых позиций. 
Blacklist – список торговых пар по которым запрещено открытие новых позиций. При добавлении в список открытой позиции, алгоритм прекращает с ней работу.
Trade_long = False – направление торговли всех пар
Trade_short = True – направление торговли всех пар

Auto_cancel_order =120 – автоотмена первого ордера в setka_1, задается в секундах.

Grid1_vol = 100 – обьем первичной сетки в $
Numb_grid = 15 – количество ордеров в сетках ( минимально 1 , максимально 10 )
Mult1 = 1 – множитель кол-ва в первичной сетке, задаётся числовым значением с шагом 0.1
Leverage_size – размер торгового плеча 
Grid1_profit =  5 – размер в %-ах тейк-профит для первого маркетного ордера в сетках 
Close_profit = 2  - общая прибыль ($) в режиме проторговки для закрытия позиций.
Step – шаг задаваемый в %-ах, для расстояния между ордерами
Mult_vol – множитель объёма в торговых сетках, задаётся числовым значением с шагом 0.1
Mult_Step – множитель step, задаётся числовым значением с шагом 0.1

Pair_limit =100 – количество торговых пар разрешённых к одновременной торговле 
Cycle_limit = 20– лимит торговых пар которые могут открываться одновременно
Cycle_timer=45m – время в минутах, в течении которого новые позиции не будут открываться если условия цикла выполнены. 

order_vol= 70 – обьем основного ореда в %-ах. Минимальное значение 50. При значении 100, устанавливается один ордер
-------------------------------------------------

Открытие сделки по сигналу
Сделка начинается с момента как поступил signal: 
- Выставляется первый ордер первый из всей сетки setka_l1. Маркет (рыночная цена)
- Размещается Grid1_profit
- При исполнении первого ордера setka_l1, устанавливается второй лимитный ордер из setka_l1. И далее после исполнения каждого лимитного ордера из setka_l1 устанавливается следующий ордер.*


 С момента установки лимитного ордера происходит разделения стратегии на 2 разные конфигурации. 
Первая является обычной. Вторая представляет из себя режим проторговки, который активируется раньше, на этапе setka_l1 
Первая:
- Размещается TP для setka_l1 лимитным ордером. При исполнении каждого лимитного ордера из setka_l1, происходит переустановка TP от новой цены усреднённой позиции. 
- Сделка продолжается до тех пор, пока не закроется по TP или не перейдет в режим проторговки.
Вторая:
- Размещается TP для первого ордера.  При срабатывании других лимитных ордеров, TP не переставляется.
- При исполнении далее каждого лимитного ордера из setka_l1, устанавливается индивидуальный TP для каждого ордера, на уровне ранее открытого ордера. Объём TP соответствует ордеру, который был открыт.  ( TP для первого лимитного ордера устанавливается на цену по которой был открыт маркет ордер. TP для второго лимитного ордера устанавливается на уровне первого лимитного ордера и тд)
- При срабатывании TP лимитного ордера, выставляется новый лимитный ордер по той же цене, где был изначально и с тем же объёмом. Так же для него выставляется TP. В случае частичного срабатывания лимитного/TP ордера необходимо скорректировать объёмы ордеров. **
- Сделка продолжается до тех пор пока не закроется по TP или не перейдет в режим проторговки.

* При невозможности разместить ордер из-за ошибки минимального размера, то размер ордера увеличивается до минимального. 
** Весь положительный PNL за вычетом комиссии биржи, от момента срабатывания первого лимитного ордера (второй ордер setka_l1) необходимо суммировать и запоминать. Сбросится он в момент закрытия сделки по TP первоначального макетного ордера или в режиме проторговки когда сделка будет закрыта.

Режим проторговки
Активация режима проторговки происходит посредством исполнения крайнего ордера в setka_1 
- Размещается торговая сетка setka_s2 в противоположном направлении торговли предыдущей сетки setka_l1. Начальное положение setka_s2 рассчитывается от цены размещения крайнего ордера setka_l1. 
- Количество контрактов в setka_s2 = setka_s1
- Шаг сетки считается как setka_s2_step=step * mult_step*
- Первый ордер setka_s2 размешается по текущей цене маркетным ордером, следом за закртиыем крайнего оредара setka_l1
- Размещается Grid1_profit

*Шаг высчитывается следующим образом:
setka_l1_step=step
setka_s2_step=step * mult_step
setka_l3_step=step * 2 * mult_step
setka_s4_step=step * 3 * mult_step
setka_l5_step=step * 4 * mult_step
setka_s6_step=step * 5 * mult_step
и так далее

-  При исполнении ТП маркетного ордера, происходит сразу же открытия новой позиции*
- При исполнении каждого лимитного ордера в любой setka, устанавливается индивидуальный TP для каждого ордера, на уровне предыдущего ордера. Объём TP соответствует ордеру, который был открыт.  ( TP для первого лимитного ордера устанавливается на цену по которой был открыт маркет ордер. TP для второго лимитного ордера устанавливается на уровне первого лимитного ордера и тд)
- При срабатывании TP лимитного ордера, выставляется новый лимитный ордер по той же цене, где был изначально и с тем же объёмом. Так же для него выставляется TP. В случае частичного срабатывания лимитного/TP ордера необходимо скорректировать объёмы ордеров. 

*Увеличение шага в сетке, если срабатывает ТП для маркетного ордера в сетке.  
При срабатывании TP для первого маркерного ордера для setka_s2, l3, s4, …, необходимо перевыставить данный ордер по текущей цене c тем же объёмом. При этом необходимо пересчитать step для сетки таким образом, чтобы все ордера новой сетки были распределены с равномерным шагом от цены открытия нового первого ордера и до крайнего ордера. При этом крайний оредр  не смещается и остается на своем первоначальном месте первоначального открытия. 
 Если сетка где был увеличен step закрылась и открывается следующая setka в обратном направлении, то step cчитается согласно формулы (не учитывается увеличение шага описанное ранее).
 Когда step в сетке превышает 3%, происходит деление каждого лимитного ордера (первый маркетный ордер в сетке не делим) на 2е части в пропорции 50/50контрактов. Первая часть устанавливается согласно степ, вторая часть устанавливается степ/2 (ровно между двумя ордерами). Соответственно выставляются дополнительные TP согласно новой расстановки.

Закрытие сделки.
Закрытие сделки происходит в момент когда текущий минус  по позиции и сумарный PNL( который считатся с setka_l1) достигают значения Close_profit.
 Текущий минус по позиции составляет -50$. Сумарный профит по всем сделкам этой пары составляет 52$, Close_profit=2. То выставляется маркетный ордер и сделка закрывается.

Дополнительная опция дробление лимитных ордеров TP order_vol
Относится только к новым сделкам. 
Дробление ордеров TP на две части, при котором все ордера TP в сетках разбиваются на два ордера. В настройках задаётся объём первого ордера в %-ах  (order_vol= 70), вторая часть ордера размещается на +/-1 тик от цены размещения первого части в зависимости от направления торговли.
* Необходимо проверять объём ордера, так как возможны случаи, когда ордер не может быть разделён на двое по причине ограничений минимального объёма одного ордера или актив не имеет дробных частей контрактов и текущие настройки приводят к невозможности деления.  Если дробление в заданной пропорции не осуществимо, то приравниваем order_vol=50. Если и в этом случаи невозможно поделить ордер, то ставится один ордер.

Pair_limit
Общий лимит пар - 20, первый цикл равен 3 парам. Это значит что пока три пары не перейдут в режим проторговки, новые позиции открываться не будет. 
 Когда открыты 3 позиции и они перешли в режим проторговки, активируется таймер, в данном случае 45м.
  Если пары остались в том же количестве в проторговке и прошло 45м, то добавляются еще 3 новые пары. Итого cycle_limit=6. И так далее, пока не упремся в Pair_limit=20. Так как 20 не делится на 3, то при 18парах в проторговке, будут открыты 2пары (остаток). 
 Если cycle_limit=3, добавились еще 3 пары и закрылись по тп, таймер не запускается заново. Он запускается только в случае, когда уперлись в cycle_limit. 
 cycle_limit=3, добавились еще 3 пары и закрылись по тп и одна пара из проторговки закрылась. То возвращаемся на предыдущий цикл и ждем снова пока не наберется 3 пары в проторговке, потом запускаем таймер и тд. 

Автоматическое понижение торгового плеча при достижении лимита обьема.
Автоматический изменять размер торгового плеча, с шагом 20-15-10-5-4-3-2-1, если возникает ошибка по достижении максимального объёма	.





ТГ БОТ
 


Таблица

 

Веб панель


 

Панель заголовков - всегда

Настройки – ключи, 
Сделки – открываем страницу с карточками сделок
Юзеры –  таблица пользователей

Запустить – цикл, сеткой
Остановить - остановить
Пауза – оставливает открытие новых ордеров, открытые ордера продолжают до авто завершения.

Whitelist – торговые пары по которым возможна работа.
Black list - торговые пары по которым не возможна работа. Если по торговой паре сделка уже открыта, то дальнейшая работа по ней прекращается. 

Баланс – общий баланс по всем сделкам. 
Лев PNL – сумма по всем открытым позициям с начала торговли

Лев К-во сделок = сумма сделок по всем позициям с начала торговли



Цикл – период либо задается, либо вкл. Помесячно. Дата начала, дата окончания.
Средн. PNL – сумма по всем открытым позициям в цикле

Средн. К-во сделок = сумма сделок по всем позициям в цикле


Карт
Имя
Время открытия позиции
Step + long/short (этап)


Админка, 1 админ 2 юзера
